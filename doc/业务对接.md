# 终端连接流程:
设备开启 ---》设备连接网关申请Server地址 --》断开网关并发送登录命令到Server ----》Server上做 mysql验证-----》写redis----》保持连接完成登录

# 登录命令格式,byte数组示例:
```
 [   STX    ]  [ 帐长度   ] [          终端号            ] [命令字] [帧来源]   [传输类型]  [    登录时间    ]   [终端类型]  [结束标识],  [      校验和(17)    ]
{ 0x4E, 0x57,   0x00, 0xFF,   0x00,  0x**,  0x**, 0x**,   0x02,   0x00,     0x02,     9, -100, -81, 25,   0x00,      0x68,     0x00,0x00,0x00,0x11}
```

==================================================
谢小强:
如果要重连也可以做,只是下面要麻烦些

胡俊:
网关这个设置需要单独设置，重登不能修改登录网关的地址，重登只是临时性质的，如果断连，就要重走网关

谢小强:
那不用修改协议,

谢小强:
还是二原来的二条指令,02和08的,

谢小强:
默认登陆网关,要指向其它地址,请按08指令给IP和端口.

谢小强:
重连的时间我重新指向网关就行了,

谢小强:
让网关再给IP.

谢小强:
连接TCP断线,终端不会掉线的,

谢小强:
掉线只能是超时没有数据来才算是掉线,

谢小强:
因为2G有时信号不稳定TCP连接会一秒就断了,
2秒就上了,所以不要以TCP连接做为掉线重新连接网关,

谢小强:
我们一般是以约定时间没有数据包过来算是掉线,

谢小强:
比如我们电桩是4分钟,内一直没有数据包来就算是掉线,会重启连接模块,

谢小强:
中间有数据来,定时数清零重计,

谢小强:
这可以备免网络不稳的情况,

谢小强:
TCP老是断连,再上,或跳一条TCP连接,

谢小强:
回复数据,始终是以最后一包的IP来回复就行了,

谢小强:
这边一般都是监听最后一包的IP数据的,

问题:
登录上线没有记录号， 但有终端类型， 监控中心应答没有终端类型?
谢小强:
消息分二类,
一个是登陆类,还不太确定在那一个IP上交互数据,只有三条指令,登陆,心跳,退出三条指令,这三条是一般带终端类型的,不用记录号,
另一类是数据交互类,一般已经是在登陆是确认过类型了,这个时候有这个记录号,

谢小强:
 记录号一般是仿止数据重复或丢失才会加上的,

谢小强:
记录号这个字段可以用也可以不使用,

谢小强:
不使用时默认填零就行了,

谢小强:
还有终端类型,目前眼镜就只有后个款,没必要区分,也是可以默认填零的,

谢小强:
暂时不用处理,到类型多的时候,使用起来区分.

谢小强:
做统计,做图表,

谢小强:
这个比如,你做多几款,做区分,男款,女款,卡通款,到时你可以跟据上线率来统计那一款卖得多,他们的使用情况是怎么样的.


网关回复我指令时,带有IP和端口,然后在Server也回复我08指令是IP和端口填零,我就不会再跳IP了,

请问是否可以根据传输类型 （0：中心向设备请求数据， 1:中心应答, 2: 设备主动上报）来判断具体协议的格式，如下：
0. 请求数据 (服务器读取终端数据)
 [   STX    ]  [ 帐长度   ] [       终端号            ] [命令字] [帧来源] [传输类型] [    数据域    ] [记录序号] [结束标识],[      校验和(4位)   ]
{ 0x4E, 0x57,   0x00, 0xFF, 0x00,  0x**,  0x**, 0x**,  0x02,   0x00,   0x00,     	N,   		4位,       0x68,     0x00,0x00,0x00,0x11}

1. 中心应答(响应终端)
 [   STX    ]  [ 帐长度   ] [       终端号            ] [命令字] [帧来源] [传输类型] [    数据域    ]  [结束标识],[      校验和(4位)   ]
{ 0x4E, 0x57,   0x00, 0xFF, 0x00,  0x**,  0x**, 0x**,  0x01,   0x00,   0x01,     	N,   		 0x68,     0x00,0x00,0x00,0x11}

2. 设备主动上报
 [   STX    ]  [ 帐长度   ] [       终端号            ] [命令字] [帧来源] [传输类型] [    数据域    ]  [结束标识],[      校验和(4位)   ]
{ 0x4E, 0x57,   0x00, 0xFF, 0x00,  0x**,  0x**, 0x**,  0x01,   0x00,   0x02,     	N,   		 0x68,     0x00,0x00,0x00,0x11}

谢小强:
能直接从第9字节获取命令字，从11字节获取传输类型的